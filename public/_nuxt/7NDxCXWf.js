import{r as m,x as k,j as S,c as n,a as s,k as v,t as p,s as B,y as h,m as d,v as i,d as _,o as a}from"./BSD6ajEG.js";const U={key:0,class:"flex justify-center items-center py-12"},j={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},M={class:"flex"},T={class:"ml-3"},N={class:"text-sm text-red-700"},A={key:2,class:"bg-green-50 border-l-4 border-green-500 p-4 mb-6"},D={key:3,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},E={class:"lg:col-span-2"},P={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},$={class:"mt-6"},Q={class:"mt-6 flex justify-end"},I=["disabled"],H={key:0,class:"flex items-center"},J={key:1},L={class:"lg:col-span-1"},O={class:"bg-white shadow-md rounded-lg p-6 mb-6"},F={class:"space-y-4"},R={class:"text-xl font-semibold text-pink-600"},G={class:"text-md"},K={class:"text-md"},W={class:"text-md"},X={class:"mt-6"},Y={class:"bg-white shadow-md rounded-lg p-6"},Z={key:0,class:"text-sm text-red-600"},ee={key:1,class:"text-sm text-green-600"},se={class:"mt-4"},te=["disabled"],oe={key:0,class:"flex items-center justify-center"},le={key:1},ae={__name:"profile",setup(re){const b=m(!1),g=m(!1),u=m(null),w=m(!1),x=m(!1),c=m(null),f=m(null),t=k({username:"",nickname:"",email:"",qq:"",bio:"",balance:0,role:"",created_at:null,last_login:null}),r=k({current_password:"",new_password:"",confirm_password:""}),q=async()=>{try{b.value=!0,u.value=null;const l=await fetch("/api/user/profile",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await l.json();if(!l.ok)throw new Error(e.message||"获取用户资料失败");const o=e.data;t.username=o.username,t.nickname=o.nickname||"",t.email=o.email||"",t.qq=o.qq||"",t.bio=o.bio||"",t.balance=o.balance||0,t.role=o.role,t.created_at=o.created_at,t.last_login=o.last_login}catch(l){console.error("获取用户资料出错:",l),u.value=l.message||"获取用户资料时发生错误，请重试"}finally{b.value=!1}},V=async()=>{try{g.value=!0,u.value=null,w.value=!1;const l=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({nickname:t.nickname,email:t.email,qq:t.qq,bio:t.bio})}),e=await l.json();if(!l.ok)throw new Error(e.message||"更新资料失败");w.value=!0,setTimeout(()=>{w.value=!1},3e3)}catch(l){console.error("更新资料出错:",l),u.value=l.message||"更新资料时发生错误，请重试"}finally{g.value=!1}},z=async()=>{try{if(r.new_password!==r.confirm_password){c.value="两次输入的密码不一致";return}if(r.new_password.length<6){c.value="密码长度不能少于6位";return}x.value=!0,c.value=null,f.value=null;const l=await fetch("/api/user/password",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({current_password:r.current_password,new_password:r.new_password})}),e=await l.json();if(!l.ok)throw new Error(e.message||"更新密码失败");f.value="密码更新成功",r.current_password="",r.new_password="",r.confirm_password="",setTimeout(()=>{f.value=null},3e3)}catch(l){console.error("更新密码出错:",l),c.value=l.message||"更新密码时发生错误，请重试"}finally{x.value=!1}},C=l=>({admin:"管理员",user:"普通用户",level1:"一级代理",level2:"二级代理",level3:"三级代理"})[l]||l,y=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未记录";return S(()=>{q()}),(l,e)=>(a(),n("div",null,[e[30]||(e[30]=s("div",{class:"mb-6"},[s("h1",{class:"text-2xl font-bold text-gray-800"},"个人资料"),s("p",{class:"text-gray-600 mt-1"},"管理您的账户信息")],-1)),b.value?(a(),n("div",U,e[9]||(e[9]=[s("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):u.value?(a(),n("div",j,[s("div",M,[e[10]||(e[10]=s("div",{class:"flex-shrink-0"},[s("svg",{class:"h-5 w-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm-1-5v-1h2v1h-2zm0-3V7h2v1h-2z","clip-rule":"evenodd"})])],-1)),s("div",T,[s("p",N,p(u.value),1)])])])):v("",!0),w.value?(a(),n("div",A,e[11]||(e[11]=[B('<div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><p class="text-sm text-green-700">资料更新成功！</p></div></div>',1)]))):v("",!0),!b.value&&!u.value?(a(),n("div",D,[s("div",E,[s("form",{onSubmit:h(V,["prevent"]),class:"bg-white shadow-md rounded-lg p-6"},[e[19]||(e[19]=s("h2",{class:"text-lg font-medium text-gray-800 mb-4"},"基本信息",-1)),s("div",P,[s("div",null,[e[12]||(e[12]=s("label",{for:"username",class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),d(s("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=o=>t.username=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-gray-100",disabled:""},null,512),[[i,t.username]]),e[13]||(e[13]=s("p",{class:"mt-1 text-xs text-gray-500"},"用户名不可修改",-1))]),s("div",null,[e[14]||(e[14]=s("label",{for:"nickname",class:"block text-sm font-medium text-gray-700 mb-1"},"昵称",-1)),d(s("input",{type:"text",id:"nickname","onUpdate:modelValue":e[1]||(e[1]=o=>t.nickname=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请输入昵称"},null,512),[[i,t.nickname]])]),s("div",null,[e[15]||(e[15]=s("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"邮箱",-1)),d(s("input",{type:"email",id:"email","onUpdate:modelValue":e[2]||(e[2]=o=>t.email=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请输入邮箱"},null,512),[[i,t.email]])]),s("div",null,[e[16]||(e[16]=s("label",{for:"qq",class:"block text-sm font-medium text-gray-700 mb-1"},"QQ",-1)),d(s("input",{type:"text",id:"qq","onUpdate:modelValue":e[3]||(e[3]=o=>t.qq=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请输入QQ号码"},null,512),[[i,t.qq]])])]),s("div",$,[e[17]||(e[17]=s("label",{for:"bio",class:"block text-sm font-medium text-gray-700 mb-1"},"个人简介",-1)),d(s("textarea",{id:"bio","onUpdate:modelValue":e[4]||(e[4]=o=>t.bio=o),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"简单介绍一下自己吧"},null,512),[[i,t.bio]])]),s("div",Q,[s("button",{type:"submit",disabled:g.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"},[g.value?(a(),n("span",H,e[18]||(e[18]=[s("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),_(" 保存中... ")]))):(a(),n("span",J,"保存资料"))],8,I)])],32)]),s("div",L,[s("div",O,[e[24]||(e[24]=s("h2",{class:"text-lg font-medium text-gray-800 mb-4"},"账户信息",-1)),s("div",F,[s("div",null,[e[20]||(e[20]=s("div",{class:"text-sm text-gray-500"},"账户余额",-1)),s("div",R,"¥"+p(t.balance||"0.00"),1)]),s("div",null,[e[21]||(e[21]=s("div",{class:"text-sm text-gray-500"},"用户角色",-1)),s("div",G,p(C(t.role)),1)]),s("div",null,[e[22]||(e[22]=s("div",{class:"text-sm text-gray-500"},"注册时间",-1)),s("div",K,p(y(t.created_at)),1)]),s("div",null,[e[23]||(e[23]=s("div",{class:"text-sm text-gray-500"},"最后登录",-1)),s("div",W,p(y(t.last_login)),1)])]),s("div",X,[s("button",{onClick:e[5]||(e[5]=o=>l.$router.push("/recharge")),class:"w-full px-4 py-2 border border-pink-300 rounded-md shadow-sm text-sm font-medium text-pink-700 bg-pink-50 hover:bg-pink-100 focus:outline-none"}," 充值余额 ")])]),s("div",Y,[e[29]||(e[29]=s("h2",{class:"text-lg font-medium text-gray-800 mb-4"},"修改密码",-1)),s("form",{onSubmit:h(z,["prevent"]),class:"space-y-4"},[s("div",null,[e[25]||(e[25]=s("label",{for:"current_password",class:"block text-sm font-medium text-gray-700 mb-1"},"当前密码",-1)),d(s("input",{type:"password",id:"current_password","onUpdate:modelValue":e[6]||(e[6]=o=>r.current_password=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请输入当前密码",required:""},null,512),[[i,r.current_password]])]),s("div",null,[e[26]||(e[26]=s("label",{for:"new_password",class:"block text-sm font-medium text-gray-700 mb-1"},"新密码",-1)),d(s("input",{type:"password",id:"new_password","onUpdate:modelValue":e[7]||(e[7]=o=>r.new_password=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请输入新密码",required:""},null,512),[[i,r.new_password]])]),s("div",null,[e[27]||(e[27]=s("label",{for:"confirm_password",class:"block text-sm font-medium text-gray-700 mb-1"},"确认新密码",-1)),d(s("input",{type:"password",id:"confirm_password","onUpdate:modelValue":e[8]||(e[8]=o=>r.confirm_password=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请确认新密码",required:""},null,512),[[i,r.confirm_password]])]),c.value?(a(),n("div",Z,p(c.value),1)):v("",!0),f.value?(a(),n("div",ee,p(f.value),1)):v("",!0),s("div",se,[s("button",{type:"submit",disabled:x.value,class:"w-full px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"},[x.value?(a(),n("span",oe,e[28]||(e[28]=[s("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),_(" 更新中... ")]))):(a(),n("span",le,"更新密码"))],8,te)])],32)])])])):v("",!0)]))}};export{ae as default};
