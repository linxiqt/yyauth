import{B as $,r as d,g as U,j as C,c as n,a as o,t as k,k as M,m as l,d as f,v as u,G as I,F as B,l as F,y as z,p as E,o as i}from"./BSD6ajEG.js";const G={class:"mb-6"},N={class:"flex items-center"},A={key:0,class:"flex justify-center items-center py-12"},P={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},Q={class:"flex"},R={class:"ml-3"},H={class:"text-sm text-red-700"},J={key:2,class:"bg-white shadow-md rounded-lg overflow-hidden p-6"},L={class:"mb-4"},O={key:0},Y={class:"mb-4"},K=["value"],W={class:"mb-4"},X={class:"mb-4"},Z={class:"mb-4"},ee={class:"mb-4"},oe={class:"mb-4"},te={class:"mb-4"},se={class:"flex justify-end mt-6"},re=["disabled"],ne={key:0},ie={key:1},de={__name:"[id]",setup(le){const w=$(),h=E(),b=w.params.id,v=d(!0),a=d(""),r=d({domain:"",app_id:"",ip:"",qq:"",version:"",price:0,original_price:0,outtime:0}),c=d(!1),p=d(""),y=d(null),g=U(()=>{var t;return((t=y.value)==null?void 0:t.role)==="admin"}),x=d([]);async function _(){try{const e=await(await fetch("/api/apps?limit=100",{method:"GET",headers:{"Content-Type":"application/json"}})).json();e.success?x.value=e.data.items||[]:console.error("获取应用列表失败:",e.message)}catch(t){console.error("获取应用列表出错:",t)}}async function q(){try{const e=await(await fetch("/api/user/profile",{method:"GET",headers:{"Content-Type":"application/json"}})).json();e.code===200?y.value=e.data:(console.error("获取用户信息失败:",e.message),a.value="获取用户信息失败，请重新登录")}catch(t){console.error("获取用户信息出错:",t),t.value="获取用户信息出错，请稍后再试"}}async function S(){try{v.value=!0,a.value="";const e=await(await fetch(`/api/auth/${b}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(e.code===200){const s=e.data;if(r.value={domain:s.domain,app_id:s.app_id,ip:s.ip||"",qq:s.qq||"",version:s.version||"",price:s.price||0,original_price:s.original_price||0,outtime:s.outtime||0},s.outtime){const m=new Date(s.outtime*1e3);p.value=j(m)}}else a.value=e.message||"获取授权信息失败"}catch(t){console.error("获取授权信息出错:",t),t.value="服务器错误，请稍后再试"}finally{v.value=!1}}function j(t){if(!t)return"";const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0"),T=String(t.getHours()).padStart(2,"0"),V=String(t.getMinutes()).padStart(2,"0");return`${e}-${s}-${m}T${T}:${V}`}async function D(){try{c.value=!0,a.value="";const t={domain:r.value.domain};if(g.value&&(t.app_id=r.value.app_id,t.ip=r.value.ip,t.qq=r.value.qq,t.version=r.value.version,t.price=r.value.price,t.original_price=r.value.original_price,p.value)){const m=new Date(p.value);t.outtime=Math.floor(m.getTime()/1e3)}const s=await(await fetch(`/api/auth/${b}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();s.success?(alert("授权更新成功"),h.push("/auth/list")):a.value=s.message||"更新授权失败"}catch(t){console.error("提交表单出错:",t),t.value="服务器错误，请稍后再试"}finally{c.value=!1}}return C(async()=>{try{await q(),await Promise.all([_(),S()])}catch(t){console.error("初始化页面出错:",t),t.value="初始化页面出错，请稍后再试"}}),(t,e)=>(i(),n("div",null,[o("div",G,[o("div",N,[o("button",{onClick:e[0]||(e[0]=s=>t.$router.back()),class:"mr-3 text-gray-600 hover:text-gray-900"},e[10]||(e[10]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),e[11]||(e[11]=o("h1",{class:"text-2xl font-bold text-gray-800"},"编辑授权",-1))]),e[12]||(e[12]=o("p",{class:"text-gray-600 mt-1"},"修改授权信息",-1))]),v.value?(i(),n("div",A,e[13]||(e[13]=[o("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):a.value?(i(),n("div",P,[o("div",Q,[e[14]||(e[14]=o("div",{class:"flex-shrink-0"},[o("svg",{class:"h-5 w-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm-1-5v-1h2v1h-2zm0-3V7h2v1h-2z","clip-rule":"evenodd"})])],-1)),o("div",R,[o("p",H,k(a.value),1)])])])):(i(),n("div",J,[o("form",{onSubmit:z(D,["prevent"])},[o("div",L,[e[15]||(e[15]=o("label",{for:"domain",class:"block text-sm font-medium text-gray-700 mb-1"},[f("域名 "),o("span",{class:"text-red-500"},"*")],-1)),l(o("input",{type:"text",id:"domain","onUpdate:modelValue":e[1]||(e[1]=s=>r.value.domain=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"例如: example.com",required:""},null,512),[[u,r.value.domain]])]),g.value?(i(),n("div",O,[o("div",Y,[e[17]||(e[17]=o("label",{for:"app_id",class:"block text-sm font-medium text-gray-700 mb-1"},[f("所属应用 "),o("span",{class:"text-red-500"},"*")],-1)),l(o("select",{id:"app_id","onUpdate:modelValue":e[2]||(e[2]=s=>r.value.app_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",required:""},[e[16]||(e[16]=o("option",{value:"",disabled:""},"请选择应用",-1)),(i(!0),n(B,null,F(x.value,s=>(i(),n("option",{key:s.id,value:s.id},k(s.name),9,K))),128))],512),[[I,r.value.app_id]])]),o("div",W,[e[18]||(e[18]=o("label",{for:"ip",class:"block text-sm font-medium text-gray-700 mb-1"},"IP地址",-1)),l(o("input",{type:"text",id:"ip","onUpdate:modelValue":e[3]||(e[3]=s=>r.value.ip=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"例如: 127.0.0.1"},null,512),[[u,r.value.ip]])]),o("div",X,[e[19]||(e[19]=o("label",{for:"qq",class:"block text-sm font-medium text-gray-700 mb-1"},"联系方式 (QQ)",-1)),l(o("input",{type:"text",id:"qq","onUpdate:modelValue":e[4]||(e[4]=s=>r.value.qq=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"例如: 12345678"},null,512),[[u,r.value.qq]])]),o("div",Z,[e[20]||(e[20]=o("label",{for:"version",class:"block text-sm font-medium text-gray-700 mb-1"},"版本",-1)),l(o("input",{type:"text",id:"version","onUpdate:modelValue":e[5]||(e[5]=s=>r.value.version=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"例如: 1.0.0"},null,512),[[u,r.value.version]])]),o("div",ee,[e[21]||(e[21]=o("label",{for:"price",class:"block text-sm font-medium text-gray-700 mb-1"},"价格",-1)),l(o("input",{type:"number",id:"price","onUpdate:modelValue":e[6]||(e[6]=s=>r.value.price=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"例如: 99.99",step:"0.01",min:"0"},null,512),[[u,r.value.price,void 0,{number:!0}]])]),o("div",oe,[e[22]||(e[22]=o("label",{for:"original_price",class:"block text-sm font-medium text-gray-700 mb-1"},"原价",-1)),l(o("input",{type:"number",id:"original_price","onUpdate:modelValue":e[7]||(e[7]=s=>r.value.original_price=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"例如: 199.99",step:"0.01",min:"0"},null,512),[[u,r.value.original_price,void 0,{number:!0}]])]),o("div",te,[e[23]||(e[23]=o("label",{for:"expiry_date",class:"block text-sm font-medium text-gray-700 mb-1"},[f("到期时间 "),o("span",{class:"text-red-500"},"*")],-1)),l(o("input",{type:"datetime-local",id:"expiry_date","onUpdate:modelValue":e[8]||(e[8]=s=>p.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",required:""},null,512),[[u,p.value]])])])):M("",!0),o("div",se,[o("button",{type:"button",onClick:e[9]||(e[9]=s=>t.$router.back()),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none mr-3"}," 取消 "),o("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none",disabled:c.value},[c.value?(i(),n("span",ne,"保存中...")):(i(),n("span",ie,"保存更改"))],8,re)])],32)]))]))}};export{de as default};
