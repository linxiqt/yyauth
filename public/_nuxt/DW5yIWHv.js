import{_ as Q,r as d,g as U,j as $,c as t,a as e,k as L,n as p,t as i,F as y,l as h,m as V,d as _,v as N,p as E,o}from"./BSD6ajEG.js";const H={class:"flex"},I={class:"flex-shrink-0"},R={key:0,class:"h-5 w-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},q={key:1,class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},G={class:"ml-3"},K={class:"text-sm font-medium"},W={class:"bg-white shadow-md rounded-lg overflow-hidden"},X={class:"bg-gray-50 px-6 py-4 border-b"},Y={class:"flex justify-between"},Z={class:"mt-2 flex justify-between px-8"},ee={class:"p-6"},se={key:0,class:"space-y-6"},te={key:0,class:"flex justify-center py-8"},oe={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4"},le={class:"flex"},ne={class:"ml-3"},ie={class:"text-sm text-red-700"},ae={key:2,class:"text-center py-8 text-gray-500"},de={key:3,class:"grid md:grid-cols-3 gap-6"},re=["onClick"],ce={class:"text-lg font-medium text-gray-900"},ue={class:"mt-2 text-sm text-gray-600 line-clamp-3"},pe={class:"flex justify-end mt-6"},me=["disabled"],ve={key:1,class:"space-y-6"},xe={class:"grid md:grid-cols-2 gap-6"},fe={class:"border rounded-lg p-6"},ge={class:"text-lg font-medium text-gray-900 mb-4"},be={class:"prose prose-sm"},ye={class:"border rounded-lg p-6"},he={class:"space-y-4"},_e={class:"flex justify-between mt-6"},we=["disabled"],ke={key:2,class:"space-y-6"},Ce={key:0,class:"text-center py-8 text-gray-500"},je={key:1,class:"grid md:grid-cols-3 gap-8"},ze=["onClick"],Be={class:"text-xl font-bold mb-2"},Me={class:"text-3xl font-bold text-pink-600 mb-4"},Se={class:"mb-6 text-left"},Le={class:"flex justify-between mt-6"},Ve=["disabled"],Ne={key:3,class:"space-y-6"},Pe={class:"border rounded-lg p-6"},Te={class:"space-y-4"},Ae={class:"flex justify-between"},Oe={class:"font-medium"},De={class:"flex justify-between"},Fe={class:"font-medium"},Je={class:"flex justify-between"},Qe={class:"font-medium"},Ue={class:"flex justify-between"},$e={class:"font-medium"},Ee={class:"flex justify-between"},He={class:"font-medium text-lg text-pink-600"},Ie={class:"flex justify-between mt-6"},Re=["disabled"],qe={key:0,class:"flex items-center"},Ge={key:1},Ke={__name:"buy",setup(We){const P=E(),M=["选择应用","应用详情","选择版本","确认订单"],a=d(0),w=d(!0),x=d(null),g=d(!1),k=d([]),r=d(null),m=d(""),b=d(""),c=d(null),f=d(null),v=d({show:!1,type:"success",message:""}),C=(n,s="success")=>{v.value={show:!0,type:s,message:n},setTimeout(()=>{v.value.show=!1},5e3)},j=U(()=>{var n;return(n=f.value)!=null&&n.pricing_content?(typeof f.value.pricing_content=="object"?f.value.pricing_content:JSON.parse(f.value.pricing_content)).plans||[]:[]}),T=async()=>{w.value=!0,x.value=null;try{const s=await(await fetch("/api/apps")).json();s.success?k.value=s.data.items.filter(l=>l.is_active!==!1):x.value=s.message||"获取应用列表失败"}catch(n){x.value="获取应用数据时发生错误",console.error(n)}finally{w.value=!1}},A=async()=>{try{const s=await(await fetch("/api/settings/public")).json();s.success?f.value=s.data:console.error("获取公共设置失败:",s.message)}catch(n){console.error("获取公共设置失败:",n)}},O=n=>{r.value=n},D=n=>{c.value=n},z=()=>{a.value<M.length-1&&a.value++},B=()=>{a.value>0&&a.value--},F=async()=>{if(!(!r.value||!m.value||!c.value)){g.value=!0;try{const s=await(await fetch("/api/auth/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app_id:r.value.id,domain:m.value,contact:b.value,plan:c.value.name,price:c.value.price})})).json();s.success?(C("授权购买成功！即将跳转到授权列表页..."),setTimeout(()=>{P.push("/auth/list")},2e3)):(C(s.message||"购买授权失败","error"),a.value=3)}catch(n){C("处理购买请求时发生错误","error"),console.error(n)}finally{g.value=!1}}};return $(()=>{T(),A()}),(n,s)=>(o(),t("div",null,[s[26]||(s[26]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-800"},"购买授权"),e("p",{class:"text-gray-600 mt-1"},"选择您需要的应用并完成授权购买")],-1)),v.value.show?(o(),t("div",{key:0,class:p(["mb-4 p-4 rounded-md",v.value.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},[e("div",H,[e("div",I,[v.value.type==="success"?(o(),t("svg",R,s[2]||(s[2]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)]))):(o(),t("svg",q,s[3]||(s[3]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)])))]),e("div",G,[e("p",K,i(v.value.message),1)])])],2)):L("",!0),e("div",W,[e("div",X,[e("div",Y,[(o(),t(y,null,h(M,(l,u)=>e("div",{key:u,class:"flex flex-col items-center flex-1"},[e("div",{class:p(["w-8 h-8 rounded-full flex items-center justify-center",[a.value>u?"bg-green-500 text-white":a.value===u?"bg-pink-500 text-white":"bg-gray-200 text-gray-600"]])},i(u+1),3),e("div",{class:p(["text-sm mt-1",a.value===u?"text-pink-600 font-medium":"text-gray-500"])},i(l),3)])),64))]),e("div",Z,[e("div",{class:p(["h-1 flex-1 rounded",a.value>0?"bg-pink-500":"bg-gray-200"])},null,2),s[4]||(s[4]=e("div",{class:"mx-2"},null,-1)),e("div",{class:p(["h-1 flex-1 rounded",a.value>1?"bg-pink-500":"bg-gray-200"])},null,2),s[5]||(s[5]=e("div",{class:"mx-2"},null,-1)),e("div",{class:p(["h-1 flex-1 rounded",a.value>2?"bg-pink-500":"bg-gray-200"])},null,2)])]),e("div",ee,[a.value===0?(o(),t("div",se,[s[8]||(s[8]=e("h2",{class:"text-lg font-semibold text-gray-800"},"选择应用",-1)),w.value?(o(),t("div",te,s[6]||(s[6]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"},null,-1)]))):x.value?(o(),t("div",oe,[e("div",le,[s[7]||(s[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm-1-5v-1h2v1h-2zm0-3V7h2v1h-2z","clip-rule":"evenodd"})])],-1)),e("div",ne,[e("p",ie,i(x.value),1)])])])):k.value.length===0?(o(),t("div",ae," 暂无可购买的应用 ")):(o(),t("div",de,[(o(!0),t(y,null,h(k.value,l=>(o(),t("div",{key:l.id,class:p(["border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",r.value&&r.value.id===l.id?"border-pink-500 bg-pink-50":""]),onClick:u=>O(l)},[e("h3",ce,i(l.name),1),e("p",ue,i(l.description||"暂无描述"),1)],10,re))),128))])),e("div",pe,[e("button",{onClick:z,disabled:!r.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50"}," 下一步 ",8,me)])])):a.value===1?(o(),t("div",ve,[s[13]||(s[13]=e("h2",{class:"text-lg font-semibold text-gray-800"},"应用详情",-1)),e("div",xe,[e("div",fe,[e("h3",ge,i(r.value.name),1),e("div",be,[e("p",null,i(r.value.description||"暂无应用描述"),1)])]),e("div",ye,[s[12]||(s[12]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"授权信息",-1)),e("form",he,[e("div",null,[s[9]||(s[9]=e("label",{for:"domain",class:"block text-sm font-medium text-gray-700"},[_("授权域名 "),e("span",{class:"text-red-500"},"*")],-1)),V(e("input",{type:"text",id:"domain","onUpdate:modelValue":s[0]||(s[0]=l=>m.value=l),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"请输入域名，如：example.com"},null,512),[[N,m.value]]),s[10]||(s[10]=e("p",{class:"mt-1 text-xs text-gray-500"},"请输入不含http://或https://的域名",-1))]),e("div",null,[s[11]||(s[11]=e("label",{for:"contact",class:"block text-sm font-medium text-gray-700"},"联系方式",-1)),V(e("input",{type:"text",id:"contact","onUpdate:modelValue":s[1]||(s[1]=l=>b.value=l),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"QQ或其他联系方式（可选）"},null,512),[[N,b.value]])])])])]),e("div",_e,[e("button",{onClick:B,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," 上一步 "),e("button",{onClick:z,disabled:!m.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50"}," 下一步 ",8,we)])])):a.value===2?(o(),t("div",ke,[s[16]||(s[16]=e("h2",{class:"text-lg font-semibold text-gray-800"},"选择授权版本",-1)),!j.value||j.value.length===0?(o(),t("div",Ce," 暂无可用版本 ")):(o(),t("div",je,[(o(!0),t(y,null,h(j.value,(l,u)=>(o(),t("div",{key:u,class:p(["border rounded-lg p-6 text-center cursor-pointer hover:shadow-md transition-shadow",c.value&&c.value.name===l.name?"border-pink-500 bg-pink-50":""]),onClick:S=>D(l)},[e("h3",Be,i(l.name),1),e("div",Me,[_("¥"+i(l.price),1),s[14]||(s[14]=e("span",{class:"text-sm text-gray-500"},"/月",-1))]),e("ul",Se,[(o(!0),t(y,null,h(l.features,(S,J)=>(o(),t("li",{key:J,class:"mb-2 flex items-center"},[s[15]||(s[15]=e("svg",{class:"w-5 h-5 mr-2 text-pink-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),_(" "+i(S),1)]))),128))])],10,ze))),128))])),e("div",Le,[e("button",{onClick:B,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," 上一步 "),e("button",{onClick:z,disabled:!c.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50"}," 下一步 ",8,Ve)])])):a.value===3?(o(),t("div",Ne,[s[25]||(s[25]=e("h2",{class:"text-lg font-semibold text-gray-800"},"确认订单",-1)),e("div",Pe,[s[23]||(s[23]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"订单摘要",-1)),e("div",Te,[e("div",Ae,[s[17]||(s[17]=e("span",{class:"text-gray-700"},"应用名称：",-1)),e("span",Oe,i(r.value.name),1)]),e("div",De,[s[18]||(s[18]=e("span",{class:"text-gray-700"},"授权域名：",-1)),e("span",Fe,i(m.value),1)]),e("div",Je,[s[19]||(s[19]=e("span",{class:"text-gray-700"},"联系方式：",-1)),e("span",Qe,i(b.value||"未提供"),1)]),e("div",Ue,[s[20]||(s[20]=e("span",{class:"text-gray-700"},"授权版本：",-1)),e("span",$e,i(c.value.name),1)]),e("div",Ee,[s[21]||(s[21]=e("span",{class:"text-gray-700"},"授权价格：",-1)),e("span",He,"¥"+i(c.value.price),1)]),s[22]||(s[22]=e("div",{class:"pt-4 border-t border-gray-200"},[e("p",{class:"text-sm text-gray-500"},'点击"完成购买"按钮将创建授权，如余额不足将无法完成购买。')],-1))])]),e("div",Ie,[e("button",{onClick:B,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," 上一步 "),e("button",{onClick:F,disabled:g.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50"},[g.value?(o(),t("span",qe,s[24]||(s[24]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),_(" 处理中... ")]))):(o(),t("span",Ge,"完成购买"))],8,Re)])])):L("",!0)])])]))}},Ye=Q(Ke,[["__scopeId","data-v-38a17d51"]]);export{Ye as default};
