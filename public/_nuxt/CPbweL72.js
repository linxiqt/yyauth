import{_ as B}from"./DP0j2Fss.js";import{_ as L,r as a,g as V,j as T,c as n,a as e,k as y,b as h,w as k,t as i,F as $,l as D,d as v,p as F,o as l,n as M}from"./BSD6ajEG.js";const P={class:"flex justify-between items-center mb-6"},R={key:0,class:"flex justify-center py-12"},q={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},G={key:2,class:"text-center py-12 bg-gray-50 rounded-lg"},H={key:3,class:"grid md:grid-cols-2 lg:grid-cols-3 gap-6"},J={class:"flex items-center mb-4"},K={class:"w-12 h-12 rounded-full bg-pink-100 flex items-center justify-center mr-3"},O=["src"],Q={key:1,class:"text-pink-600 text-xl"},U={class:"font-bold text-lg"},W={class:"text-gray-600 text-sm"},X={key:0,class:"text-gray-700 mb-4"},Y={class:"flex justify-between mb-4"},Z={class:"text-center px-3"},tt={class:"text-xl font-bold text-pink-600"},et={class:"text-center px-3"},st={class:"text-xl font-bold text-green-600"},ot={class:"flex flex-wrap justify-between pt-3 border-t"},nt={class:"flex space-x-2"},lt=["onClick"],rt=["onClick"],at={key:4,class:"flex justify-center mt-8"},it={class:"flex space-x-1"},dt=["onClick"],ct={key:5,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ut={class:"bg-white rounded-lg p-6 max-w-md w-full"},vt={class:"mb-6"},xt={class:"font-bold"},mt={class:"flex justify-end space-x-3"},ft={__name:"index",setup(pt){const m=F(),f=a([]),c=a(!0),u=a(null),p=a(1),w=a(0),C=a(9),x=a(!1),g=a(null),j=V(()=>Math.ceil(w.value/C.value)),_=async(o=1)=>{try{c.value=!0,u.value=null;const t=localStorage.getItem("token");if(!t){m.push("/login");return}const r=await fetch(`/api/apps?page=${o}&limit=${C.value}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok){if(r.status===401||r.status===403){localStorage.removeItem("token"),localStorage.removeItem("user"),m.push("/login");return}throw new Error("无法获取应用列表")}const d=await r.json();if(!d.success)throw new Error(d.message||"获取应用列表失败");f.value=d.data.items,w.value=d.data.total,p.value=o}catch(t){console.error("获取应用列表错误:",t),u.value=t.message}finally{c.value=!1}},E=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),S=o=>{m.push(`/apps/${o.id}`)},z=o=>{g.value=o,x.value=!0},I=async()=>{try{c.value=!0;const o=localStorage.getItem("token"),t=await fetch(`/api/apps/${g.value.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}});if(!t.ok)throw new Error("删除应用失败");const r=await t.json();if(!r.success)throw new Error(r.message||"删除应用失败");x.value=!1,await _(p.value)}catch(o){console.error("删除应用错误:",o),u.value=o.message}finally{c.value=!1}},N=o=>{_(o)};return T(()=>{_()}),(o,t)=>{var d;const r=B;return l(),n("div",null,[e("div",P,[t[2]||(t[2]=e("h1",{class:"text-2xl font-bold"},"应用列表",-1)),h(r,{to:"/apps/new",class:"btn-primary"},{default:k(()=>t[1]||(t[1]=[v("创建应用")])),_:1})]),c.value?(l(),n("div",R,t[3]||(t[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):u.value?(l(),n("div",q,i(u.value),1)):f.value.length===0?(l(),n("div",G,[t[5]||(t[5]=e("div",{class:"text-5xl mb-4"},"📱",-1)),t[6]||(t[6]=e("h3",{class:"text-xl font-bold text-gray-700 mb-2"},"暂无应用",-1)),t[7]||(t[7]=e("p",{class:"text-gray-600 mb-6"},"您还没有创建任何应用，立即创建第一个应用",-1)),h(r,{to:"/apps/new",class:"btn-primary"},{default:k(()=>t[4]||(t[4]=[v("创建应用")])),_:1})])):(l(),n("div",H,[(l(!0),n($,null,D(f.value,s=>{var b;return l(),n("div",{key:s.id,class:"card hover:shadow-lg"},[e("div",J,[e("div",K,[s.icon?(l(),n("img",{key:0,src:s.icon,alt:"应用图标",class:"w-8 h-8"},null,8,O)):(l(),n("span",Q,"📱"))]),e("div",null,[e("h3",U,i(s.name),1),e("p",W,i(E(s.created_at)),1)])]),s.description?(l(),n("p",X,i(s.description),1)):y("",!0),e("div",Y,[e("div",Z,[e("div",tt,i(s.auth_count||0),1),t[8]||(t[8]=e("div",{class:"text-gray-600 text-sm"},"授权总数",-1))]),t[10]||(t[10]=e("div",{class:"border-r border-gray-200"},null,-1)),e("div",et,[e("div",st,i(((b=s.update_config)==null?void 0:b.latest_version)||"未设置"),1),t[9]||(t[9]=e("div",{class:"text-gray-600 text-sm"},"最新版本",-1))])]),e("div",ot,[h(r,{to:`/apps/${s.id}`,class:"text-pink-600 hover:text-pink-800"},{default:k(()=>t[11]||(t[11]=[v(" 管理 ")])),_:2},1032,["to"]),e("div",nt,[e("button",{onClick:A=>S(s),class:"text-blue-600 hover:text-blue-800"}," 编辑 ",8,lt),e("button",{onClick:A=>z(s),class:"text-red-600 hover:text-red-800"}," 删除 ",8,rt)])])])}),128))])),j.value>1?(l(),n("div",at,[e("div",it,[(l(!0),n($,null,D(j.value,s=>(l(),n("button",{key:s,onClick:b=>N(s),class:M(["px-3 py-1 rounded",p.value===s?"bg-pink-500 text-white":"bg-gray-200 hover:bg-gray-300"])},i(s),11,dt))),128))])])):y("",!0),x.value?(l(),n("div",ct,[e("div",ut,[t[14]||(t[14]=e("h3",{class:"text-xl font-bold mb-4"},"确认删除",-1)),e("p",vt,[t[12]||(t[12]=v("您确定要删除应用 ")),e("span",xt,i((d=g.value)==null?void 0:d.name),1),t[13]||(t[13]=v("？此操作不可逆，并将删除所有关联的授权、公告和更新日志。"))]),e("div",mt,[e("button",{onClick:t[0]||(t[0]=s=>x.value=!1),class:"px-4 py-2 border rounded hover:bg-gray-100"}," 取消 "),e("button",{onClick:I,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"}," 确定删除 ")])])])):y("",!0)])}}},bt=L(ft,[["__scopeId","data-v-325e0552"]]);export{bt as default};
