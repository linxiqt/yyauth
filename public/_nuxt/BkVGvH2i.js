import{r as i,x as q,g as A,j as W,c as n,a as t,k as v,t as d,m,v as y,H as X,G as P,s as L,F as N,l as T,d as p,o as a,n as I}from"./BSD6ajEG.js";const Y={key:0,class:"flex justify-center items-center py-12"},Z={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},ee={class:"flex"},te={class:"ml-3"},se={class:"text-sm text-red-700"},le={key:2},oe={class:"bg-white p-4 rounded-lg shadow-md mb-6"},ne={class:"flex flex-col md:flex-row gap-4"},ae={class:"w-full md:w-1/3"},re={class:"w-full md:w-1/4"},ie={class:"flex-grow text-right"},de={class:"bg-white rounded-lg shadow-md overflow-hidden"},ue={class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},ce={class:"bg-white divide-y divide-gray-200"},me={key:0},ve={class:"px-6 py-4 whitespace-nowrap"},xe={class:"flex items-center"},be={class:"text-sm font-medium text-gray-900"},ge={class:"text-sm text-gray-500"},fe={class:"px-6 py-4 whitespace-nowrap"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ke={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},_e=["onClick"],Ce=["onClick"],ze={class:"px-6 py-3 flex items-center justify-between border-t border-gray-200"},$e={class:"flex-1 flex justify-between sm:hidden"},Ue=["disabled"],Me=["disabled"],je={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Ve={class:"text-sm text-gray-700"},Be={class:"font-medium"},Se={class:"font-medium"},Ee={class:"font-medium"},De={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Ae=["disabled"],Pe=["onClick"],Le={key:1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},Ne=["disabled"],Te={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ie={class:"bg-white rounded-lg p-6 w-full max-w-md"},Fe={class:"space-y-4"},He={key:0,class:"text-sm text-red-600"},Re={class:"mt-6 flex justify-end space-x-3"},Ke=["disabled"],Ge={key:0,class:"flex items-center"},Je={key:1},Oe={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Qe={class:"bg-white rounded-lg p-6 w-full max-w-md"},qe={class:"mb-6"},We={class:"font-semibold"},Xe={key:0,class:"text-sm text-red-600 mb-4"},Ye={class:"flex justify-end space-x-3"},Ze=["disabled"],et={key:0,class:"flex items-center"},tt={key:1},M=10,ot={__name:"index",setup(st){const j=i(!1),w=i(null),V=i([]),h=i(0),r=i(1),k=i(""),_=i(""),C=i(!1),o=q({id:null,username:"",nickname:"",email:"",role:"",balance:0}),z=i(!1),x=i(null),$=i(!1),B=i(null),U=i(!1),b=i(null),S=i(null),c=async(l=1)=>{try{j.value=!0,w.value=null,r.value=l;const e=new URLSearchParams({page:l,limit:M});k.value&&e.append("search",k.value),_.value&&e.append("role",_.value);const f=await fetch(`/api/users?${e.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await f.json();if(!f.ok)throw new Error(s.message||"获取用户列表失败");V.value=s.data.users,h.value=s.data.total}catch(e){console.error("获取用户列表出错:",e),w.value=e.message||"获取用户列表时发生错误，请重试"}finally{j.value=!1}},F=async()=>{try{const l=await fetch("/api/user/profile",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await l.json();l.ok&&(S.value=e.data.id)}catch(l){console.error("获取当前用户信息出错:",l)}},H=l=>{o.id=l.id,o.username=l.username,o.nickname=l.nickname||"",o.email=l.email||"",o.role=l.role,o.balance=l.balance||0,x.value=null,C.value=!0},R=async()=>{try{z.value=!0,x.value=null;const l=await fetch(`/api/users/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({nickname:o.nickname,email:o.email,role:o.role,balance:parseFloat(o.balance)})}),e=await l.json();if(!l.ok)throw new Error(e.message||"更新用户失败");C.value=!1,c(r.value)}catch(l){console.error("更新用户出错:",l),x.value=l.message||"更新用户时发生错误，请重试"}finally{z.value=!1}},K=l=>{B.value=l,b.value=null,$.value=!0},G=async()=>{try{U.value=!0,b.value=null;const l=await fetch(`/api/users/${B.value.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await l.json();if(!l.ok)throw new Error(e.message||"删除用户失败");$.value=!1,c(r.value)}catch(l){console.error("删除用户出错:",l),b.value=l.message||"删除用户时发生错误，请重试"}finally{U.value=!1}},u=A(()=>Math.ceil(h.value/M)),J=A(()=>u.value<=7?Array.from({length:u.value},(l,e)=>e+1):r.value<=3?[1,2,3,4,5,"...",u.value]:r.value>=u.value-2?[1,"...",u.value-4,u.value-3,u.value-2,u.value-1,u.value]:[1,"...",r.value-1,r.value,r.value+1,"...",u.value]),g=l=>{l<1||l>u.value||c(l)},O=l=>({admin:"管理员",user:"普通用户",level1:"一级代理",level2:"二级代理",level3:"三级代理"})[l]||l,Q=l=>({admin:"bg-purple-100 text-purple-800",user:"bg-gray-100 text-gray-800",level1:"bg-blue-100 text-blue-800",level2:"bg-green-100 text-green-800",level3:"bg-yellow-100 text-yellow-800"})[l]||"bg-gray-100 text-gray-800",E=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未记录";return W(()=>{F(),c(1)}),(l,e)=>{var f;return a(),n("div",null,[e[39]||(e[39]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"用户管理"),t("p",{class:"text-gray-600 mt-1"},"管理系统用户")],-1)),j.value?(a(),n("div",Y,e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):w.value?(a(),n("div",Z,[t("div",ee,[e[17]||(e[17]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm-1-5v-1h2v1h-2zm0-3V7h2v1h-2z","clip-rule":"evenodd"})])],-1)),t("div",te,[t("p",se,d(w.value),1)])])])):(a(),n("div",le,[t("div",oe,[t("div",ne,[t("div",ae,[m(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),placeholder:"搜索用户名、昵称或邮箱",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",onKeyup:e[1]||(e[1]=X(s=>c(1),["enter"]))},null,544),[[y,k.value]])]),t("div",re,[m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",onChange:e[3]||(e[3]=s=>c(1))},e[18]||(e[18]=[L('<option value="">所有角色</option><option value="admin">管理员</option><option value="user">普通用户</option><option value="level1">一级代理</option><option value="level2">二级代理</option><option value="level3">三级代理</option>',6)]),544),[[P,_.value]])]),t("div",ie,[t("button",{onClick:e[4]||(e[4]=s=>c(1)),class:"px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 focus:outline-none"}," 查询 ")])])]),t("div",de,[t("div",ue,[t("table",pe,[e[20]||(e[20]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"用户"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"角色"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"余额"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"注册时间"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"最后登录"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"操作")])],-1)),t("tbody",ce,[V.value.length===0?(a(),n("tr",me,e[19]||(e[19]=[t("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"}," 没有找到匹配的用户 ",-1)]))):v("",!0),(a(!0),n(N,null,T(V.value,s=>(a(),n("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",ve,[t("div",xe,[t("div",null,[t("div",be,d(s.username),1),t("div",ge,d(s.email||"未设置邮箱"),1)])])]),t("td",fe,[t("span",{class:I([Q(s.role),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},d(O(s.role)),3)]),t("td",ye," ¥"+d(s.balance||"0.00"),1),t("td",we,d(E(s.created_at)),1),t("td",he,d(E(s.last_login)),1),t("td",ke,[t("button",{onClick:D=>H(s),class:"text-pink-600 hover:text-pink-900 mr-3"}," 编辑 ",8,_e),s.id!==S.value?(a(),n("button",{key:0,onClick:D=>K(s),class:"text-red-600 hover:text-red-900"}," 删除 ",8,Ce)):v("",!0)])]))),128))])])]),t("div",ze,[t("div",$e,[t("button",{onClick:e[5]||(e[5]=s=>g(r.value-1)),disabled:r.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," 上一页 ",8,Ue),t("button",{onClick:e[6]||(e[6]=s=>g(r.value+1)),disabled:r.value===u.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," 下一页 ",8,Me)]),t("div",je,[t("div",null,[t("p",Ve,[e[21]||(e[21]=p(" 显示 ")),t("span",Be,d((r.value-1)*M+1),1),e[22]||(e[22]=p(" 至 ")),t("span",Se,d(Math.min(r.value*M,h.value)),1),e[23]||(e[23]=p(" 条，共 ")),t("span",Ee,d(h.value),1),e[24]||(e[24]=p(" 条记录 "))])]),t("div",null,[t("nav",De,[t("button",{onClick:e[7]||(e[7]=s=>g(r.value-1)),disabled:r.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},e[25]||(e[25]=[t("span",{class:"sr-only"},"上一页",-1),t("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]),8,Ae),(a(!0),n(N,null,T(J.value,s=>(a(),n("span",{key:s},[s!=="..."?(a(),n("button",{key:0,onClick:D=>g(s),class:I(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",r.value===s?"z-10 bg-pink-50 border-pink-500 text-pink-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"])},d(s),11,Pe)):(a(),n("span",Le," ... "))]))),128)),t("button",{onClick:e[8]||(e[8]=s=>g(r.value+1)),disabled:r.value===u.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},e[26]||(e[26]=[t("span",{class:"sr-only"},"下一页",-1),t("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)]),8,Ne)])])])])])])),C.value?(a(),n("div",Te,[t("div",Ie,[e[34]||(e[34]=t("h2",{class:"text-xl font-bold mb-4"},"编辑用户",-1)),t("div",Fe,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=s=>o.username=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-gray-100",disabled:""},null,512),[[y,o.username]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"昵称",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=s=>o.nickname=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500"},null,512),[[y,o.nickname]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"邮箱",-1)),m(t("input",{type:"email","onUpdate:modelValue":e[11]||(e[11]=s=>o.email=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500"},null,512),[[y,o.email]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"角色",-1)),m(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>o.role=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500"},e[30]||(e[30]=[L('<option value="admin">管理员</option><option value="user">普通用户</option><option value="level1">一级代理</option><option value="level2">二级代理</option><option value="level3">三级代理</option>',5)]),512),[[P,o.role]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"余额",-1)),m(t("input",{type:"number","onUpdate:modelValue":e[13]||(e[13]=s=>o.balance=s),step:"0.01",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500"},null,512),[[y,o.balance]])]),x.value?(a(),n("div",He,d(x.value),1)):v("",!0)]),t("div",Re,[t("button",{onClick:e[14]||(e[14]=s=>C.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," 取消 "),t("button",{onClick:R,disabled:z.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"},[z.value?(a(),n("span",Ge,e[33]||(e[33]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),p(" 保存中... ")]))):(a(),n("span",Je,"保存"))],8,Ke)])])])):v("",!0),$.value?(a(),n("div",Oe,[t("div",Qe,[e[38]||(e[38]=t("h2",{class:"text-xl font-bold mb-4"},"确认删除",-1)),t("p",qe,[e[35]||(e[35]=p("您确定要删除用户 ")),t("span",We,d((f=B.value)==null?void 0:f.username),1),e[36]||(e[36]=p(" 吗？此操作不可逆。"))]),b.value?(a(),n("div",Xe,d(b.value),1)):v("",!0),t("div",Ye,[t("button",{onClick:e[15]||(e[15]=s=>$.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," 取消 "),t("button",{onClick:G,disabled:U.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"},[U.value?(a(),n("span",et,e[37]||(e[37]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),p(" 删除中... ")]))):(a(),n("span",tt,"确认删除"))],8,Ze)])])])):v("",!0)])}}};export{ot as default};
