import{_ as M}from"./DP0j2Fss.js";import{_ as L,r as c,g as w,j as V,c as l,a as t,t as a,b as y,q as D,w as x,F as E,l as $,p as F,o as r,n as H}from"./BSD6ajEG.js";const q={key:0,class:"flex justify-center py-12"},J={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},O={key:2,class:"space-y-6"},T={class:"card bg-gradient-to-r from-pink-500 to-purple-500 text-white"},U={class:"flex flex-col md:flex-row md:items-center justify-between"},G={class:"text-2xl font-bold mb-2"},K={class:"mt-4 md:mt-0"},P={class:"bg-white bg-opacity-20 rounded-lg px-4 py-2"},Q={class:"text-2xl font-bold"},W={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},X={class:"card"},Y={class:"flex items-center justify-between"},Z={class:"text-3xl font-bold text-pink-600 mt-2"},tt={class:"card"},et={class:"flex items-center justify-between"},st={class:"text-3xl font-bold text-green-600 mt-2"},ot={class:"card"},at={class:"flex items-center justify-between"},nt={class:"text-3xl font-bold text-purple-600 mt-2"},rt={class:"card"},lt={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},it={class:"card"},dt={key:0,class:"text-center py-8 bg-gray-50 rounded"},ct={key:1,class:"overflow-x-auto"},ut={class:"min-w-full divide-y divide-gray-200"},pt={class:"bg-white divide-y divide-gray-200"},xt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},vt={class:"px-6 py-4 whitespace-nowrap"},ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ht={__name:"dashboard",setup(bt){const _=F(),v=c(!0),g=c(null),f=c(null),m=c(null),h=c([]),b=c([]),A=w(()=>new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})),C=w(()=>b.value.length),S=w(()=>{var s;return((s=f.value)==null?void 0:s.role)==="admin"}),I=async()=>{try{v.value=!0,g.value=null;const s=localStorage.getItem("token");if(!s){_.push("/login");return}const e=localStorage.getItem("user");if(e)try{f.value=JSON.parse(e)}catch(n){console.error("解析用户信息失败",n)}const o=await fetch("/api/dashboard",{headers:{Authorization:`Bearer ${s}`}});if(!o.ok){if(o.status===401||o.status===403){localStorage.removeItem("token"),localStorage.removeItem("user"),_.push("/login");return}throw new Error("无法获取仪表盘数据")}const d=await o.json();if(d.code!==200)throw new Error(d.message||"获取仪表盘数据失败");m.value=d.data;const u=await fetch("/api/apps",{headers:{Authorization:`Bearer ${s}`}});if(u.ok){const n=await u.json();n.success&&(b.value=n.data.items)}const p=await fetch("/api/auth?limit=5",{headers:{Authorization:`Bearer ${s}`}});if(p.ok){const n=await p.json();n.code==200&&(h.value=n.data.records)}}catch(s){console.error("获取仪表盘数据错误:",s),g.value=s.message}finally{v.value=!1}},k=s=>parseInt(s.outtime*1e3)>Date.now(),N=s=>new Date(s*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),R=s=>{const e=b.value.find(o=>o.id===s);return e?e.name:"未知应用"};return V(()=>{I()}),(s,e)=>{var d,u,p,n,j,z,B;const o=M;return r(),l("div",null,[e[17]||(e[17]=t("h1",{class:"text-2xl font-bold mb-6"},"仪表盘",-1)),v.value?(r(),l("div",q,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):g.value?(r(),l("div",J,a(g.value),1)):(r(),l("div",O,[t("div",T,[t("div",U,[t("div",null,[t("h2",G,"欢迎回来，"+a((d=f.value)==null?void 0:d.username),1),t("p",null,"今天是 "+a(A.value)+"，祝您使用愉快！",1)]),t("div",K,[t("div",P,[e[1]||(e[1]=t("span",{class:"text-sm"},"账户余额",-1)),t("div",Q,"¥"+a(((p=(u=m.value)==null?void 0:u.userInfo)==null?void 0:p.balance)||0),1)])])])]),t("div",W,[t("div",X,[t("div",Y,[t("div",null,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-700"},"授权总数",-1)),t("div",Z,a(((j=(n=m.value)==null?void 0:n.stats)==null?void 0:j.authTotal)||0),1)]),e[3]||(e[3]=t("div",{class:"bg-pink-100 rounded-full p-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-pink-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1))])]),t("div",tt,[t("div",et,[t("div",null,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-700"},"有效授权",-1)),t("div",st,a(((B=(z=m.value)==null?void 0:z.stats)==null?void 0:B.authActive)||0),1)]),e[5]||(e[5]=t("div",{class:"bg-green-100 rounded-full p-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),t("div",ot,[t("div",at,[t("div",null,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-gray-700"},"应用数量",-1)),t("div",nt,a(C.value),1)]),e[7]||(e[7]=t("div",{class:"bg-purple-100 rounded-full p-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1))])])]),t("div",rt,[e[13]||(e[13]=t("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"快速操作",-1)),t("div",lt,[y(o,{to:"/apps/new",class:"bg-pink-50 hover:bg-pink-100 p-4 rounded-lg text-center transition-colors"},{default:x(()=>e[8]||(e[8]=[t("div",{class:"text-pink-600 text-2xl mb-2"},"📱",-1),t("div",{class:"font-medium"},"创建应用",-1)])),_:1}),y(o,{to:"/apps",class:"bg-purple-50 hover:bg-purple-100 p-4 rounded-lg text-center transition-colors"},{default:x(()=>e[9]||(e[9]=[t("div",{class:"text-purple-600 text-2xl mb-2"},"📋",-1),t("div",{class:"font-medium"},"管理应用",-1)])),_:1}),y(o,{to:"/profile",class:"bg-blue-50 hover:bg-blue-100 p-4 rounded-lg text-center transition-colors"},{default:x(()=>e[10]||(e[10]=[t("div",{class:"text-blue-600 text-2xl mb-2"},"👤",-1),t("div",{class:"font-medium"},"个人资料",-1)])),_:1}),S.value?(r(),D(o,{key:0,to:"/settings",class:"bg-green-50 hover:bg-green-100 p-4 rounded-lg text-center transition-colors"},{default:x(()=>e[11]||(e[11]=[t("div",{class:"text-green-600 text-2xl mb-2"},"⚙️",-1),t("div",{class:"font-medium"},"系统设置",-1)])),_:1})):(r(),D(o,{key:1,to:"#",class:"bg-green-50 hover:bg-green-100 p-4 rounded-lg text-center transition-colors"},{default:x(()=>e[12]||(e[12]=[t("div",{class:"text-green-600 text-2xl mb-2"},"💰",-1),t("div",{class:"font-medium"},"充值余额",-1)])),_:1}))])]),t("div",it,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"最近授权记录",-1)),h.value.length===0?(r(),l("div",dt,e[14]||(e[14]=[t("p",{class:"text-gray-500"},"暂无授权记录",-1)]))):(r(),l("div",ct,[t("table",ut,[e[15]||(e[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"域名"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"应用"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"版本"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"状态"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"到期时间")])],-1)),t("tbody",pt,[(r(!0),l(E,null,$(h.value,i=>(r(),l("tr",{key:i.id},[t("td",xt,a(i.domain),1),t("td",gt,a(R(i.app_id)),1),t("td",mt,a(i.version),1),t("td",vt,[t("span",{class:H([k(i)?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},a(k(i)?"有效":"已过期"),3)]),t("td",ft,a(N(i.outtime)),1)]))),128))])])]))])]))])}}},_t=L(ht,[["__scopeId","data-v-329a4bba"]]);export{_t as default};
