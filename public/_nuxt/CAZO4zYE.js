import{_ as A,r as i,x as C,g as D,j as J,c as d,a as t,k as L,t as b,y as q,m as x,v as w,E as z,p as P,o as u}from"./BSD6ajEG.js";const Q={key:0,class:"flex justify-center py-12"},R={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},$={key:2,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4"},H={class:"card"},F={class:"space-y-4"},G={class:"flex items-center"},K={class:"ml-3 w-10 h-10 bg-gray-200 rounded flex items-center justify-center overflow-hidden"},W=["src"],X={class:"flex items-center space-x-2"},Y={class:"card"},Z={class:"space-y-4"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"bg-gray-50 p-3 rounded-md"},se={class:"font-medium"},oe={class:"bg-gray-50 p-3 rounded-md"},le={class:"font-medium"},re={class:"bg-gray-50 p-3 rounded-md"},ne={class:"font-medium"},ae={class:"flex justify-end"},ie=["disabled"],de={key:4,class:"fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-6 py-3 rounded shadow-lg"},ue={__name:"index",setup(me){const U=P(),_=i(!0),y=i(!1),m=i(null),k=i(!1),r=i(null),V=i(null),j=i([]),s=C({site_name:"",site_logo:"",allow_register:!0,beian_number:"",footer_code:""}),B=D(()=>{var l;return((l=V.value)==null?void 0:l.role)==="admin"}),M=async()=>{var l,e,n,g,f,p;try{_.value=!0,m.value=null;const a=localStorage.getItem("token");if(!a){U.push("/login");return}const v=localStorage.getItem("user");if(v)try{V.value=JSON.parse(v)}catch(c){console.error("解析用户信息失败",c)}if(!B.value){_.value=!1;return}const o=await fetch("/api/settings",{headers:{Authorization:`Bearer ${a}`}});if(!o.ok){if(o.status===401||o.status===403){localStorage.removeItem("token"),localStorage.removeItem("user"),U.push("/login");return}throw new Error("无法获取系统设置")}const h=await o.json();if(!h.success)throw new Error(h.message||"获取系统设置失败");r.value=h.data,s.site_name=((l=r.value.site_name)==null?void 0:l.value)||"简授权系统",s.site_logo=((e=r.value.site_logo)==null?void 0:e.value)||"/logo.png",s.allow_register=((n=r.value.allow_register)==null?void 0:n.value)||!0,s.beian_number=((g=r.value.beian_number)==null?void 0:g.value)||"",s.footer_code=((f=r.value.footer_code)==null?void 0:f.value)||"";const S=((p=r.value.home_sections)==null?void 0:p.value)||["hero","features","pricing","testimonials"],O=["hero","features","pricing","testimonials","contact"];j.value=O.map(c=>({id:c,enabled:S.includes(c)})),j.value.sort((c,T)=>{const E=S.indexOf(c.id),I=S.indexOf(T.id);return E===-1?1:I===-1?-1:E-I})}catch(a){console.error("获取系统设置错误:",a),m.value=a.message}finally{_.value=!1}},N=async()=>{try{y.value=!0,m.value=null;const l=localStorage.getItem("token"),e=await fetch("/api/settings",{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({site_name:s.site_name,site_logo:s.site_logo,allow_register:s.allow_register,home_sections:JSON.stringify(s.home_sections),beian_number:s.beian_number,footer_code:s.footer_code})});if(!e.ok)throw new Error("保存设置失败");const n=await e.json();if(!n.success)throw new Error(n.message||"保存设置失败");k.value=!0,setTimeout(()=>{k.value=!1},3e3)}catch(l){console.error("保存设置错误:",l),m.value=l.message}finally{y.value=!1}};return J(()=>{M()}),(l,e)=>{var n,g,f,p,a,v;return u(),d("div",null,[e[20]||(e[20]=t("h1",{class:"text-2xl font-bold mb-6"},"系统设置",-1)),_.value?(u(),d("div",Q,e[5]||(e[5]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):m.value?(u(),d("div",R,b(m.value),1)):B.value?(u(),d("form",{key:3,onSubmit:q(N,["prevent"]),class:"space-y-8"},[t("div",H,[e[14]||(e[14]=t("h2",{class:"text-xl font-bold mb-4"},"基本设置",-1)),t("div",F,[t("div",null,[e[6]||(e[6]=t("label",{for:"site_name",class:"block text-sm font-medium text-gray-700 mb-1"},"网站名称",-1)),x(t("input",{id:"site_name","onUpdate:modelValue":e[0]||(e[0]=o=>s.site_name=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"},null,512),[[w,s.site_name]])]),t("div",null,[e[7]||(e[7]=t("label",{for:"site_logo",class:"block text-sm font-medium text-gray-700 mb-1"},"网站Logo",-1)),t("div",G,[x(t("input",{id:"site_logo","onUpdate:modelValue":e[1]||(e[1]=o=>s.site_logo=o),type:"text",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500"},null,512),[[w,s.site_logo]]),t("div",K,[s.site_logo?(u(),d("img",{key:0,src:s.site_logo,alt:"Logo预览",class:"max-w-full max-h-full"},null,8,W)):L("",!0)])]),e[8]||(e[8]=t("p",{class:"text-sm text-gray-500 mt-1"},"输入Logo图片的URL地址",-1))]),t("div",null,[t("label",X,[x(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>s.allow_register=o),class:"h-4 w-4 text-pink-600"},null,512),[[z,s.allow_register]]),e[9]||(e[9]=t("span",null,"允许用户注册",-1))])]),t("div",null,[e[10]||(e[10]=t("label",{for:"beian_number",class:"block text-sm font-medium text-gray-700 mb-1"},"网站备案号",-1)),x(t("input",{id:"beian_number","onUpdate:modelValue":e[3]||(e[3]=o=>s.beian_number=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"例如: 浙ICP备12345678号"},null,512),[[w,s.beian_number]]),e[11]||(e[11]=t("p",{class:"text-sm text-gray-500 mt-1"},"如果没有备案号可以留空",-1))]),t("div",null,[e[12]||(e[12]=t("label",{for:"footer_code",class:"block text-sm font-medium text-gray-700 mb-1"},"底部插入代码",-1)),x(t("textarea",{id:"footer_code","onUpdate:modelValue":e[4]||(e[4]=o=>s.footer_code=o),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"可以插入统计代码、客服代码等"},null,512),[[w,s.footer_code]]),e[13]||(e[13]=t("p",{class:"text-sm text-gray-500 mt-1"},"插入在网页底部的HTML代码，如统计代码等",-1))])])]),t("div",Y,[e[19]||(e[19]=t("h2",{class:"text-xl font-bold mb-4"},"程序信息",-1)),t("div",Z,[t("div",ee,[t("div",te,[e[15]||(e[15]=t("span",{class:"text-sm text-gray-500"},"系统版本：",-1)),t("span",se,b(((g=(n=r.value)==null?void 0:n.system_version)==null?void 0:g.value)||"1.0.0"),1)]),t("div",oe,[e[16]||(e[16]=t("span",{class:"text-sm text-gray-500"},"发布日期：",-1)),t("span",le,b(((p=(f=r.value)==null?void 0:f.system_release_date)==null?void 0:p.value)||"2023-08-01"),1)]),t("div",re,[e[17]||(e[17]=t("span",{class:"text-sm text-gray-500"},"官方QQ群：",-1)),t("span",ne,b(((v=(a=r.value)==null?void 0:a.system_qq_group)==null?void 0:v.value)||"1023034217"),1)])]),e[18]||(e[18]=t("p",{class:"text-sm text-gray-500"},"程序信息仅供参考，不可修改",-1))])]),t("div",ae,[t("button",{type:"submit",class:"btn-primary",disabled:y.value},b(y.value?"保存中...":"保存设置"),9,ie)])],32)):(u(),d("div",$," 您没有权限访问系统设置页面。 ")),k.value?(u(),d("div",de," 设置保存成功！ ")):L("",!0)])}}},ge=A(ue,[["__scopeId","data-v-904bea16"]]);export{ge as default};
