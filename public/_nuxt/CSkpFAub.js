import{_}from"./B2OfKuHk.js";import{_ as k,x as h,r as l,j as S,p as N,c as i,a as t,k as m,t as f,y as V,m as g,v as x,d as y,b as j,w as I,o as d}from"./scWRxJKX.js";const T={class:"flex justify-center items-center py-12"},B={class:"w-full max-w-md"},C={class:"card"},D={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},M=["disabled"],O={class:"mt-6 text-center text-sm"},q={key:0},E={__name:"login",setup(J){const u=N(),o=h({username:"",password:""}),r=l(null),a=l(!1),c=l(null),b=async()=>{try{r.value=null,a.value=!0;const s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),e=await s.json();if(!s.ok||e.code!=200)throw new Error(e.message||"登录失败，请检查用户名和密码");localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),u.push("/dashboard"),window.location.reload()}catch(s){console.error("登录错误:",s),r.value=s.message}finally{a.value=!1}},v=async()=>{try{const e=await(await fetch("/api/settings/public")).json();e.success&&(c.value=e.data)}catch(s){console.error("获取公共设置失败:",s)}};return S(()=>{v(),localStorage.getItem("token")&&u.push("/")}),(s,e)=>{var p;const w=_;return d(),i("div",T,[t("div",B,[t("div",C,[e[6]||(e[6]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"欢迎回来"),t("p",{class:"text-gray-600"},"登录到简授权")],-1)),r.value?(d(),i("div",D,f(r.value),1)):m("",!0),t("form",{onSubmit:V(b,["prevent"]),class:"space-y-6"},[t("div",null,[e[2]||(e[2]=t("label",{for:"username",class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),g(t("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=n=>o.username=n),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"请输入用户名"},null,512),[[x,o.username]])]),t("div",null,[e[3]||(e[3]=t("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-1"},"密码",-1)),g(t("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=n=>o.password=n),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"请输入密码"},null,512),[[x,o.password]])]),t("div",null,[t("button",{type:"submit",class:"w-full btn-primary",disabled:a.value},f(a.value?"登录中...":"登录"),9,M)])],32),t("div",O,[(p=c.value)!=null&&p.allow_register?(d(),i("span",q,[e[5]||(e[5]=y(" 没有账号? ")),j(w,{to:"/register",class:"text-pink-600 hover:text-pink-800"},{default:I(()=>e[4]||(e[4]=[y("立即注册")])),_:1})])):m("",!0)])])])])}}},L=k(E,[["__scopeId","data-v-5acc5023"]]);export{L as default};
