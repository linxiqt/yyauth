import{r as p,x as z,j as C,c as l,a as t,t as y,y as U,m as n,d as c,G as _,F as k,l as w,v as a,p as M,o as i,n as T}from"./scWRxJKX.js";const B={key:0,class:"flex justify-center items-center py-12"},j={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},A={class:"flex"},F={class:"ml-3"},E={class:"text-sm text-red-700"},I={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},N={class:"col-span-2"},O=["value"],H={class:"flex flex-wrap gap-2"},P=["onClick"],Q={class:"mt-1 relative rounded-md shadow-sm"},G={class:"mt-1 relative rounded-md shadow-sm"},J={class:"mt-6"},L={class:"mt-6 flex justify-end"},R=["disabled"],Y={key:0,class:"flex items-center"},K={key:1},Z={__name:"create",setup(W){const h=M(),b=p(!1),m=p(!1),d=p(null),f=p([]),g=p(null),q=[{label:"1个月",days:30},{label:"3个月",days:90},{label:"6个月",days:180},{label:"1年",days:365},{label:"2年",days:730},{label:"永久",days:3650}],s=z({app_id:"",domain:"",ip:"",qq:"",version:"",expiry_date:"",price:"",original_price:"",remarks:""}),S=async()=>{try{b.value=!0,d.value=null;const e=await(await fetch("/api/apps",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();if(!e.success)throw new Error(e.message||"获取应用列表失败");f.value=e.data.items||[],f.value.length===0&&(d.value="您尚未创建任何应用，请先创建应用")}catch(r){console.error("获取应用列表出错:",r),d.value=r.message||"获取应用列表时发生错误，请重试"}finally{b.value=!1}},x=r=>{g.value=r;const e=new Date;e.setDate(e.getDate()+r);const o=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),v=String(e.getDate()).padStart(2,"0"),D=String(e.getHours()).padStart(2,"0"),$=String(e.getMinutes()).padStart(2,"0");s.expiry_date=`${o}-${u}-${v}T${D}:${$}`},V=async()=>{try{m.value=!0,d.value=null;const r=new Date(s.expiry_date).getTime()/1e3,e={app_id:s.app_id,domain:s.domain,ip:s.ip||null,qq:s.qq||null,version:s.version||null,outtime:r,price:s.price?parseFloat(s.price):0,original_price:s.original_price?parseFloat(s.original_price):0,remarks:s.remarks||null},o=await fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)}),u=await o.json();if(!o.ok)throw new Error(u.message||"创建授权失败");h.push("/auth/list")}catch(r){console.error("创建授权出错:",r),d.value=r.message||"创建授权时发生错误，请重试",window.scrollTo(0,0)}finally{m.value=!1}};return C(()=>{S(),x(30)}),(r,e)=>(i(),l("div",null,[e[26]||(e[26]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"创建授权"),t("p",{class:"text-gray-600 mt-1"},"为您的应用添加新的授权记录")],-1)),b.value?(i(),l("div",B,e[10]||(e[10]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"},null,-1)]))):d.value?(i(),l("div",j,[t("div",A,[e[11]||(e[11]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm-1-5v-1h2v1h-2zm0-3V7h2v1h-2z","clip-rule":"evenodd"})])],-1)),t("div",F,[t("p",E,y(d.value),1)])])])):(i(),l("form",{key:2,onSubmit:U(V,["prevent"]),class:"bg-white shadow-md rounded-lg p-6"},[t("div",I,[t("div",N,[e[13]||(e[13]=t("label",{for:"app_id",class:"block text-sm font-medium text-gray-700 mb-1"},[c("选择应用 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("select",{id:"app_id","onUpdate:modelValue":e[0]||(e[0]=o=>s.app_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",required:""},[e[12]||(e[12]=t("option",{value:""},"请选择应用",-1)),(i(!0),l(k,null,w(f.value,o=>(i(),l("option",{key:o.id,value:o.id},y(o.name),9,O))),128))],512),[[_,s.app_id]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"domain",class:"block text-sm font-medium text-gray-700 mb-1"},[c("域名 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{type:"text",id:"domain","onUpdate:modelValue":e[1]||(e[1]=o=>s.domain=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"example.com",required:""},null,512),[[a,s.domain]])]),t("div",null,[e[15]||(e[15]=t("label",{for:"ip",class:"block text-sm font-medium text-gray-700 mb-1"},"IP地址",-1)),n(t("input",{type:"text",id:"ip","onUpdate:modelValue":e[2]||(e[2]=o=>s.ip=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"选填，例如: 192.168.1.1"},null,512),[[a,s.ip]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"qq",class:"block text-sm font-medium text-gray-700 mb-1"},"联系方式",-1)),n(t("input",{type:"text",id:"qq","onUpdate:modelValue":e[3]||(e[3]=o=>s.qq=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"选填，QQ号或其他联系方式"},null,512),[[a,s.qq]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"version",class:"block text-sm font-medium text-gray-700 mb-1"},"版本",-1)),n(t("input",{type:"text",id:"version","onUpdate:modelValue":e[4]||(e[4]=o=>s.version=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"选填，例如: v1.0.0"},null,512),[[a,s.version]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"expiry_date",class:"block text-sm font-medium text-gray-700 mb-1"},[c("到期时间 "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{type:"datetime-local",id:"expiry_date","onUpdate:modelValue":e[5]||(e[5]=o=>s.expiry_date=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",required:""},null,512),[[a,s.expiry_date]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"授权时长快捷选择",-1)),t("div",H,[(i(),l(k,null,w(q,(o,u)=>t("button",{type:"button",key:u,onClick:v=>x(o.days),class:T(["px-2 py-1 text-xs border rounded-md hover:bg-pink-50",[g.value===o.days?"border-pink-500 bg-pink-50 text-pink-700":"border-gray-300 text-gray-700"]])},y(o.label),11,P)),64))])]),t("div",null,[e[21]||(e[21]=t("label",{for:"price",class:"block text-sm font-medium text-gray-700 mb-1"},"价格",-1)),t("div",Q,[e[20]||(e[20]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 sm:text-sm"},"¥")],-1)),n(t("input",{type:"number",id:"price","onUpdate:modelValue":e[6]||(e[6]=o=>s.price=o),step:"0.01",min:"0",class:"w-full pl-7 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"0.00"},null,512),[[a,s.price]])])]),t("div",null,[e[23]||(e[23]=t("label",{for:"original_price",class:"block text-sm font-medium text-gray-700 mb-1"},"原价",-1)),t("div",G,[e[22]||(e[22]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500 sm:text-sm"},"¥")],-1)),n(t("input",{type:"number",id:"original_price","onUpdate:modelValue":e[7]||(e[7]=o=>s.original_price=o),step:"0.01",min:"0",class:"w-full pl-7 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"0.00"},null,512),[[a,s.original_price]])])])]),t("div",J,[e[24]||(e[24]=t("label",{for:"remarks",class:"block text-sm font-medium text-gray-700 mb-1"},"备注",-1)),n(t("textarea",{id:"remarks","onUpdate:modelValue":e[8]||(e[8]=o=>s.remarks=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"可选，添加备注信息"},null,512),[[a,s.remarks]])]),t("div",L,[t("button",{type:"button",onClick:e[9]||(e[9]=o=>r.$router.back()),class:"mr-2 px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none"}," 取消 "),t("button",{type:"submit",disabled:m.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"},[m.value?(i(),l("span",Y,e[25]||(e[25]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),c(" 保存中... ")]))):(i(),l("span",K,"创建授权"))],8,R)])],32))]))}};export{Z as default};
