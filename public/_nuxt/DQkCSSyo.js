import{_ as v}from"./B2OfKuHk.js";import{_ as k,x as _,r as i,j as h,p as P,c as l,a as s,k as V,t as w,y as N,m as u,v as p,d as y,b as S,w as j,o as d}from"./scWRxJKX.js";const E={class:"flex justify-center items-center py-12"},T={class:"w-full max-w-md"},q={class:"card"},B={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},C=["disabled"],D={key:2,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4"},M={class:"mt-6 text-center text-sm"},U={__name:"register",setup(I){const c=P(),t=_({username:"",password:"",confirmPassword:""}),n=i(null),a=i(!1),m=i(null),b=async()=>{try{if(n.value=null,a.value=!0,t.password!==t.confirmPassword)throw new Error("两次输入的密码不一致");if(t.password.length<6)throw new Error("密码长度不能少于6个字符");const o=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t.username,password:t.password})}),e=await o.json();if(!o.ok||e.code!=200)throw new Error(e.message||"注册失败，请稍后再试");c.push("/login?registered=true")}catch(o){console.error("注册错误:",o),n.value=o.message}finally{a.value=!1}},g=async()=>{try{const e=await(await fetch("/api/settings/public")).json();e.success&&(m.value=e.data)}catch(o){console.error("获取公共设置失败:",o)}};return h(()=>{g(),localStorage.getItem("token")&&c.push("/")}),(o,e)=>{var f;const x=v;return d(),l("div",E,[s("div",T,[s("div",q,[e[8]||(e[8]=s("div",{class:"text-center mb-8"},[s("h1",{class:"text-2xl font-bold text-gray-800"},"创建账户"),s("p",{class:"text-gray-600"},"注册简授权系统")],-1)),n.value?(d(),l("div",B,w(n.value),1)):V("",!0),((f=m.value)==null?void 0:f.allow_register)!==!1?(d(),l("form",{key:1,onSubmit:N(b,["prevent"]),class:"space-y-6"},[s("div",null,[e[3]||(e[3]=s("label",{for:"username",class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),u(s("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=r=>t.username=r),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"请输入用户名"},null,512),[[p,t.username]])]),s("div",null,[e[4]||(e[4]=s("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-1"},"密码",-1)),u(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=r=>t.password=r),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"请输入密码"},null,512),[[p,t.password]])]),s("div",null,[e[5]||(e[5]=s("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700 mb-1"},"确认密码",-1)),u(s("input",{id:"confirmPassword","onUpdate:modelValue":e[2]||(e[2]=r=>t.confirmPassword=r),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"请再次输入密码"},null,512),[[p,t.confirmPassword]])]),s("div",null,[s("button",{type:"submit",class:"w-full btn-primary",disabled:a.value},w(a.value?"注册中...":"注册"),9,C)])],32)):(d(),l("div",D," 注册功能当前已关闭，请联系管理员获取账号。 ")),s("div",M,[e[7]||(e[7]=y(" 已有账号? ")),S(x,{to:"/login",class:"text-pink-600 hover:text-pink-800"},{default:j(()=>e[6]||(e[6]=[y("立即登录")])),_:1})])])])])}}},L=k(U,[["__scopeId","data-v-21d73256"]]);export{L as default};
